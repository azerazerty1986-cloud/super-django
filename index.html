<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نكهة وجمال | ناردو برو - المتجر الذكي</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a1a15;
            --bg-secondary: #1a2f28;
            --bg-card: #1a2f28;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --gold: #d4af37;
            --gold-dark: #b38f2c;
            --gold-light: #f4e3b1;
            --nardoo: #2c5e4f;
            --nardoo-light: #3e826b;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --shadow-gold: 0 10px 30px rgba(212, 175, 55, 0.2);
            --transition: all 0.3s ease;
        }

        body.light-mode {
            --bg-primary: #f5f5f5;
            --bg-secondary: #e0e0e0;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --glass: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            min-height: 100vh;
        }

        .container {
            width: 95%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* شاشة التحميل */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loader-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid var(--gold);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* الإشعارات */
        .notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 2px solid var(--gold);
            border-radius: 50px;
            padding: 15px 30px;
            color: var(--text-primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
            min-width: 300px;
            border-right: 10px solid;
        }

        .notification.success { border-right-color: #4ade80; }
        .notification.error { border-right-color: #f87171; }
        .notification.warning { border-right-color: #fbbf24; }
        .notification.info { border-right-color: #60a5fa; }

        @keyframes slideIn {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-100%); opacity: 0; }
        }

        /* الشريط العلوي */
        .top-bar {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--gold);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .top-bar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .top-bar-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .top-bar-item i { color: var(--gold); }

        .theme-toggle {
            background: var(--glass);
            border: 1px solid var(--gold);
            border-radius: 50px;
            padding: 5px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            background: var(--gold);
            color: var(--bg-primary);
        }

        /* الهيدر الرئيسي */
        .main-header {
            background: var(--bg-card);
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(-5deg);
            transition: var(--transition);
        }

        .logo:hover .logo-icon { transform: rotate(0deg) scale(1.1); }

        .logo-icon i {
            font-size: 30px;
            color: var(--bg-primary);
        }

        .logo-text h1 {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text span {
            color: var(--gold-light);
            font-size: 14px;
        }

        /* البحث */
        .search-wrapper { flex: 0 1 400px; }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            border-radius: 50px;
            padding: 5px 5px 5px 20px;
            transition: var(--transition);
        }

        .search-box:focus-within {
            border-color: var(--gold);
            box-shadow: 0 0 20px var(--gold);
        }

        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 0;
            color: var(--text-primary);
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .search-box button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gold);
            border: none;
            color: var(--bg-primary);
            cursor: pointer;
            font-size: 18px;
        }

        .search-box button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--gold);
        }

        /* أزرار الإجراءات */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--gold);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .action-btn:hover {
            background: var(--gold);
            color: var(--bg-primary);
            transform: translateY(-3px);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--gold);
            color: var(--bg-primary);
            font-size: 12px;
            font-weight: 700;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* القائمة */
        .nav-menu {
            background: var(--bg-card);
            border-radius: 60px;
            padding: 10px 20px;
            margin: 20px 0;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            border-radius: 40px;
            cursor: pointer;
        }

        .nav-link i { color: var(--gold); }

        .nav-link:hover {
            background: var(--glass);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: var(--gold);
            color: var(--bg-primary);
        }

        .nav-link.active i { color: var(--bg-primary); }

        /* الفلاتر */
        .filters-section { margin: 30px 0; }

        .categories-filter {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-btn {
            padding: 10px 25px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
        }

        .category-btn:hover,
        .category-btn.active {
            background: var(--gold);
            color: var(--bg-primary);
        }

        /* شبكة المنتجات - 3 أعمدة */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin: 30px 0;
        }

        @media (max-width: 1200px) {
            .products-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .products-grid { grid-template-columns: 1fr; }
        }

        /* بطاقة المنتج */
        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            overflow: hidden;
            transition: var(--transition);
            position: relative;
            box-shadow: var(--shadow);
        }

        .product-card:hover {
            transform: translateY(-10px);
            border-color: var(--gold);
            box-shadow: var(--shadow-gold);
        }

        .product-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--gold);
            color: var(--bg-primary);
            padding: 5px 15px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            z-index: 2;
        }

        .merchant-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--nardoo);
            color: white;
            padding: 5px 12px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* معرض الصور */
        .product-gallery {
            position: relative;
            width: 100%;
            height: 280px;
            overflow: hidden;
        }

        .swiper {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--nardoo), var(--nardoo-light));
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .swiper-slide i {
            font-size: 80px;
            color: var(--gold);
        }

        .swiper-pagination-bullet { background: var(--gold); }

        .swiper-button-next,
        .swiper-button-prev {
            color: var(--gold);
            background: rgba(0, 0, 0, 0.3);
            width: 35px;
            height: 35px;
            border-radius: 50%;
        }

        .swiper-button-next:after,
        .swiper-button-prev:after { font-size: 16px; }

        .product-info { padding: 20px; }

        .product-category {
            color: var(--gold);
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            color: var(--gold);
        }

        .product-price {
            font-size: 24px;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 15px;
        }

        .product-price small {
            font-size: 14px;
            color: var(--gold-light);
        }

        .product-stock {
            font-size: 14px;
            margin-bottom: 15px;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .in-stock { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .low-stock { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .out-of-stock { background: rgba(248, 113, 113, 0.2); color: #f87171; }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .add-to-cart {
            flex: 2;
            padding: 12px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 25px;
            color: var(--bg-primary);
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-to-cart:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--gold);
        }

        .add-to-cart:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wishlist-btn {
            flex: 1;
            padding: 12px;
            background: var(--glass);
            border: 1px solid var(--gold);
            border-radius: 25px;
            color: var(--gold);
            cursor: pointer;
        }

        .wishlist-btn:hover {
            background: var(--gold);
            color: var(--bg-primary);
        }

        /* سلة التسوق الجانبية */
        .cart-sidebar {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 2px solid var(--gold);
            z-index: 2000;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .cart-sidebar.open { left: 0; }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gold);
            margin-bottom: 20px;
        }

        .cart-header h3 { color: var(--gold); font-size: 24px; }

        .close-cart {
            color: var(--gold);
            font-size: 24px;
            cursor: pointer;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: var(--glass);
            border-radius: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: var(--nardoo);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-item-image i {
            font-size: 30px;
            color: var(--gold);
        }

        .cart-item-details { flex: 1; }

        .cart-item-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--gold);
            font-size: 14px;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 10px;
            background: var(--glass);
            border: 1px solid var(--gold);
            color: var(--gold);
            cursor: pointer;
        }

        .cart-footer {
            border-top: 2px solid var(--gold);
            padding-top: 20px;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            color: var(--gold);
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
        }

        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--bg-primary);
            border: none;
            border-radius: 25px;
            font-weight: 800;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* الفوتر */
        .footer {
            background: var(--bg-secondary);
            padding: 60px 0 30px;
            margin-top: 60px;
            border-top: 3px solid var(--gold);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-col h3 {
            color: var(--gold);
            font-size: 20px;
            margin-bottom: 20px;
        }

        .footer-col p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-col i { color: var(--gold); }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--gold-dark);
        }

        /* النوافذ المنبثقة */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--gold);
            border-radius: 30px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-lg { max-width: 1000px; }

        /* نماذج */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--gold);
        }

        .form-control {
            padding: 15px;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-primary);
            font-family: 'Cairo', sans-serif;
        }

        .form-control:focus {
            border-color: var(--gold);
            outline: none;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--bg-primary);
            border: none;
            padding: 12px 30px;
            border-radius: 40px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-outline-gold {
            background: transparent;
            border: 2px solid var(--gold);
            color: var(--gold);
            padding: 10px 25px;
            border-radius: 40px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-outline-gold:hover {
            background: var(--gold);
            color: var(--bg-primary);
        }

        /* رفع الصور */
        .image-upload-area {
            border: 2px dashed var(--gold);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
        }

        .image-upload-area i {
            font-size: 40px;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .preview-image {
            width: 100px;
            height: 100px;
            border-radius: 15px;
            object-fit: cover;
            border: 2px solid var(--gold);
        }
    </style>
</head>
<body>
    <!-- شاشة التحميل -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- الإشعارات -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- سلة التسوق الجانبية -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3><i class="fas fa-shopping-cart"></i> سلة التسوق</h3>
            <i class="fas fa-times close-cart" onclick="toggleCart()"></i>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>المجموع:</span>
                <span id="cartTotal">0 دج</span>
            </div>
            <button class="checkout-btn" onclick="checkoutCart()">
                <i class="fab fa-whatsapp"></i> إتمام الطلب
            </button>
        </div>
    </div>

    <!-- الشريط العلوي -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-item">
                <i class="fas fa-truck-fast"></i>
                <span>شحن مجاني للطلبات فوق 5000 دج</span>
            </div>
            <div class="top-bar-item">
                <i class="fas fa-headset"></i>
                <span>دعم VIP 24/7</span>
            </div>
            <div class="top-bar-item">
                <i class="fas fa-gem"></i>
                <span>منتجات أصلية 100%</span>
            </div>
            <div class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>ليلي</span>
            </div>
        </div>
    </div>

    <!-- الهيدر الرئيسي -->
    <header class="main-header">
        <div class="container header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="logo-text">
                    <h1>نكهة وجمال</h1>
                    <span>ناردو برو - المتجر الذكي</span>
                </div>
            </div>
            
            <div class="search-wrapper">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ابحث عن منتج..." onkeyup="searchProducts()">
                    <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="action-btn" onclick="openLoginModal()" id="userBtn">
                    <i class="far fa-user"></i>
                </button>
                <button class="action-btn" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCounter">0</span>
                </button>
                <button class="action-btn" onclick="openDashboard()" id="dashboardBtn" style="display: none;">
                    <i class="fas fa-chart-line"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- القائمة الرئيسية -->
    <div class="container">
        <nav class="nav-menu">
            <a class="nav-link active" onclick="filterProducts('all')">
                <i class="fas fa-home"></i> الرئيسية
            </a>
            <a class="nav-link" onclick="filterProducts('clothes')">
                <i class="fas fa-tshirt"></i> ملابس
            </a>
            <a class="nav-link" onclick="filterProducts('spices')">
                <i class="fas fa-mortar-pestle"></i> توابل
            </a>
            <a class="nav-link" onclick="filterProducts('cosmetic')">
                <i class="fas fa-spa"></i> كوسمتيك
            </a>
            <a class="nav-link" onclick="filterProducts('phones')">
                <i class="fas fa-mobile-alt"></i> هواتف
            </a>
            <a class="nav-link" onclick="filterProducts('electronics')">
                <i class="fas fa-crown"></i> إلكترونيات
            </a>
        </nav>
    </div>

    <!-- الفلاتر -->
    <div class="container filters-section">
        <div class="categories-filter" id="categoryFilters">
            <button class="category-btn active" onclick="filterProducts('all')">الكل</button>
            <button class="category-btn" onclick="filterProducts('clothes')">ملابس</button>
            <button class="category-btn" onclick="filterProducts('spices')">توابل</button>
            <button class="category-btn" onclick="filterProducts('cosmetic')">كوسمتيك</button>
            <button class="category-btn" onclick="filterProducts('phones')">هواتف</button>
            <button class="category-btn" onclick="filterProducts('electronics')">إلكترونيات</button>
        </div>
    </div>

    <!-- المنتجات - شبكة 3 أعمدة -->
    <div class="container">
        <div class="products-grid" id="productsContainer"></div>
    </div>

    <!-- الفوتر -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>نكهة وجمال</h3>
                    <p><i class="fas fa-store"></i> المتجر الذكي المتكامل</p>
                    <p><i class="fas fa-star"></i> التقييم: 4.8/5</p>
                </div>
                <div class="footer-col">
                    <h3>اتصل بنا</h3>
                    <p><i class="fab fa-whatsapp"></i> +213 562243648</p>
                    <p><i class="fas fa-phone"></i> 023 000 000</p>
                    <p><i class="fas fa-envelope"></i> info@nakha.com</p>
                </div>
                <div class="footer-col">
                    <h3>تابعنا</h3>
                    <p><i class="fab fa-facebook"></i> فيسبوك</p>
                    <p><i class="fab fa-instagram"></i> انستغرام</p>
                    <p><i class="fab fa-tiktok"></i> تيك توك</p>
                </div>
            </div>
            <div class="copyright">
                © 2026 نكهة وجمال | ناردو برو - جميع الحقوق محفوظة
            </div>
        </div>
    </footer>

    <!-- نافذة تسجيل الدخول -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 30px;">
                <i class="fas fa-user-circle" style="color: var(--gold);"></i> تسجيل الدخول
            </h2>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-gold" style="flex: 1;" onclick="switchAuthTab('login')">تسجيل دخول</button>
                <button class="btn-outline-gold" style="flex: 1;" onclick="switchAuthTab('register')">حساب جديد</button>
            </div>

            <!-- نموذج تسجيل الدخول -->
            <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                <div class="form-group">
                    <label>اسم المستخدم أو البريد الإلكتروني</label>
                    <input type="text" class="form-control" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" class="form-control" id="loginPassword" required>
                </div>
                <button type="submit" class="btn-gold" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-sign-in-alt"></i> دخول
                </button>
            </form>

            <!-- نموذج التسجيل -->
            <form id="registerForm" style="display: none;" onsubmit="event.preventDefault(); handleRegister();">
                <div class="form-group">
                    <label>الاسم الكامل</label>
                    <input type="text" class="form-control" id="regName" required>
                </div>
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" class="form-control" id="regPassword" required>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="isMerchant" onchange="toggleMerchantFields()">
                        <span>تسجيل كتاجر</span>
                    </label>
                </div>
                
                <div id="merchantFields" style="display: none;">
                    <div class="form-group">
                        <label>مستوى التاجر</label>
                        <select class="form-control" id="merchantLevel">
                            <option value="1">المستوى الأول (5 منتجات)</option>
                            <option value="2">المستوى الثاني (10 منتجات)</option>
                            <option value="3">المستوى الثالث (15 منتج)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>وصف النشاط التجاري</label>
                        <textarea class="form-control" id="merchantDesc" rows="3"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn-gold" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-user-plus"></i> تسجيل
                </button>
            </form>

            <button class="btn-outline-gold" style="width: 100%; margin-top: 15px;" onclick="closeModal('loginModal')">
                إلغاء
            </button>
        </div>
    </div>

    <!-- نافذة إضافة/تعديل منتج -->
    <div class="modal" id="productModal">
        <div class="modal-content modal-lg">
            <h2 style="text-align: center; margin-bottom: 30px;">
                <i class="fas fa-plus-circle" style="color: var(--gold);"></i>
                <span id="modalTitle">إضافة منتج جديد</span>
            </h2>

            <form id="productForm" class="product-form">
                <div class="form-group">
                    <label>اسم المنتج</label>
                    <input type="text" class="form-control" id="productName" required>
                </div>

                <div class="form-group">
                    <label>القسم</label>
                    <select class="form-control" id="productCategory" required>
                        <option value="">اختر القسم</option>
                        <option value="clothes">ملابس</option>
                        <option value="spices">توابل</option>
                        <option value="cosmetic">كوسمتيك</option>
                        <option value="phones">هواتف</option>
                        <option value="electronics">إلكترونيات</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>السعر (دج)</label>
                    <input type="number" class="form-control" id="productPrice" required min="0">
                </div>

                <div class="form-group">
                    <label>الكمية</label>
                    <input type="number" class="form-control" id="productStock" required min="0">
                </div>

                <div class="form-group">
                    <label>التاجر</label>
                    <select class="form-control" id="productMerchant">
                        <option value="">منتج عام</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>صور المنتج</label>
                    <div class="image-upload-area" onclick="document.getElementById('productImages').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>اضغط لرفع الصور</p>
                    </div>
                    <input type="file" id="productImages" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    <div class="image-preview" id="imagePreview"></div>
                </div>

                <input type="hidden" id="editingProductId">
                <input type="hidden" id="productImagesData">

                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="button" class="btn-gold" style="flex: 2;" onclick="saveProduct()">
                        <i class="fas fa-save"></i> حفظ المنتج
                    </button>
                    <button type="button" class="btn-outline-gold" style="flex: 1;" onclick="closeModal('productModal')">
                        <i class="fas fa-times"></i> إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة تفاصيل المنتج -->
    <div class="modal" id="productDetailModal">
        <div class="modal-content modal-lg" id="productDetailContent"></div>
    </div>

    <!-- نافذة لوحة التحكم -->
    <div class="modal" id="dashboardModal">
        <div class="modal-content modal-lg" style="max-width: 1200px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-chart-line" style="color: var(--gold);"></i> لوحة التحكم</h2>
                <i class="fas fa-times" style="font-size: 24px; color: var(--gold); cursor: pointer;" onclick="closeModal('dashboardModal')"></i>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn-gold" onclick="showDashboardTab('overview')">نظرة عامة</button>
                <button class="btn-outline-gold" onclick="showDashboardTab('products')">إدارة المنتجات</button>
                <button class="btn-outline-gold" onclick="showDashboardTab('orders')">الطلبات</button>
                <button class="btn-outline-gold" onclick="showDashboardTab('merchants')">التجار</button>
                <button class="btn-outline-gold" onclick="showDashboardTab('stats')">الإحصائيات</button>
            </div>
            
            <div id="dashboardContent"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <script>
        // ========== المتغيرات العامة ==========
        let products = [];
        let currentUser = null;
        let cart = [];
        let isDarkMode = true;
        let currentFilter = 'all';
        let searchTerm = '';
        let users = [];

        // ========== الدوال الأساسية ==========
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-times-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('light-mode', !isDarkMode);
            const toggle = document.getElementById('themeToggle');
            toggle.innerHTML = isDarkMode ? 
                '<i class="fas fa-moon"></i><span>ليلي</span>' : 
                '<i class="fas fa-sun"></i><span>نهاري</span>';
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ========== إدارة المنتجات ==========
        function loadProducts() {
            const saved = localStorage.getItem('products');
            if (saved) {
                products = JSON.parse(saved);
            } else {
                // منتجات افتراضية
                products = [
                    { 
                        id: 1, 
                        name: "بهارات برياني أصلية", 
                        category: "spices", 
                        price: 4500, 
                        stock: 15, 
                        rating: 4.5,
                        images: ["https://via.placeholder.com/300/2c5e4f/ffffff?text=برياني"],
                        merchantId: null
                    },
                    { 
                        id: 2, 
                        name: "زيت أرغان للشعر", 
                        category: "cosmetic", 
                        price: 3500, 
                        stock: 8, 
                        rating: 4.8,
                        images: ["https://via.placeholder.com/300/d4af37/000000?text=أرغان"],
                        merchantId: null
                    },
                    { 
                        id: 3, 
                        name: "زعفران أصلي", 
                        category: "spices", 
                        price: 12000, 
                        stock: 25, 
                        rating: 5.0,
                        images: ["https://via.placeholder.com/300/8b0000/ffffff?text=زعفران"],
                        merchantId: null
                    },
                    { 
                        id: 4, 
                        name: "ماسك طين طبيعي", 
                        category: "cosmetic", 
                        price: 2500, 
                        stock: 3, 
                        rating: 4.3,
                        images: ["https://via.placeholder.com/300/228b22/ffffff?text=طين"],
                        merchantId: null
                    },
                    { 
                        id: 5, 
                        name: "خلطة مندي خاصة", 
                        category: "spices", 
                        price: 3800, 
                        stock: 7, 
                        rating: 4.0,
                        images: ["https://via.placeholder.com/300/cd853f/ffffff?text=مندي"],
                        merchantId: null
                    },
                    { 
                        id: 6, 
                        name: "هاتف ذكي", 
                        category: "phones", 
                        price: 45000, 
                        stock: 5, 
                        rating: 4.7,
                        images: ["https://via.placeholder.com/300/000000/ffffff?text=هاتف"],
                        merchantId: null
                    }
                ];
            }
            saveProducts();
            displayProducts();
        }

        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
        }

        function getCategoryName(category) {
            const names = {
                'clothes': 'ملابس',
                'spices': 'توابل',
                'cosmetic': 'كوسمتيك',
                'phones': 'هواتف',
                'electronics': 'إلكترونيات'
            };
            return names[category] || 'أخرى';
        }

        function displayProducts() {
            const container = document.getElementById('productsContainer');
            if (!container) return;

            let filtered = products;
            
            if (currentFilter !== 'all') {
                filtered = filtered.filter(p => p.category === currentFilter);
            }

            if (searchTerm) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }

            if (filtered.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px;">لا توجد منتجات</div>';
                return;
            }

            container.innerHTML = filtered.map(product => {
                const stockClass = product.stock <= 0 ? 'out-of-stock' : product.stock < 5 ? 'low-stock' : 'in-stock';
                const stockText = product.stock <= 0 ? 'غير متوفر' : product.stock < 5 ? `كمية محدودة (${product.stock})` : `متوفر (${product.stock})`;

                const images = product.images && product.images.length > 0 ? product.images : ["https://via.placeholder.com/300/2c5e4f/ffffff?text=نكهة+وجمال"];

                const slides = images.map(img => `
                    <div class="swiper-slide">
                        <img src="${img}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/300/2c5e4f/ffffff?text=صورة'">
                    </div>
                `).join('');

                return `
                    <div class="product-card" data-id="${product.id}">
                        <div class="product-badge">${product.rating} ⭐</div>
                        
                        <div class="product-gallery">
                            <div class="swiper product-swiper-${product.id}">
                                <div class="swiper-wrapper">
                                    ${slides}
                                </div>
                                <div class="swiper-pagination"></div>
                                <div class="swiper-button-next"></div>
                                <div class="swiper-button-prev"></div>
                            </div>
                        </div>

                        <div class="product-info">
                            <div class="product-category">
                                <i class="fas fa-tag"></i> ${getCategoryName(product.category)}
                            </div>
                            <h3 class="product-title">${product.name}</h3>
                            <div class="product-price">${product.price.toLocaleString()} <small>دج</small></div>
                            <div class="product-stock ${stockClass}">${stockText}</div>
                            
                            <div class="product-actions">
                                <button class="add-to-cart" onclick="addToCart(${product.id})" ${product.stock <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-shopping-cart"></i> أضف للسلة
                                </button>
                                <button class="wishlist-btn" onclick="viewProductDetails(${product.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // تهيئة Swiper
            setTimeout(() => {
                filtered.forEach(product => {
                    if (document.querySelector(`.product-swiper-${product.id}`)) {
                        new Swiper(`.product-swiper-${product.id}`, {
                            pagination: { el: '.swiper-pagination', clickable: true },
                            navigation: {
                                nextEl: '.swiper-button-next',
                                prevEl: '.swiper-button-prev',
                            },
                            loop: true,
                            autoplay: { delay: 3000, disableOnInteraction: false },
                        });
                    }
                });
            }, 100);
        }

        function filterProducts(category) {
            currentFilter = category;
            
            document.querySelectorAll('.nav-link, .category-btn').forEach(el => {
                el.classList.remove('active');
            });
            
            document.querySelectorAll(`[onclick*="${category}"]`).forEach(el => {
                el.classList.add('active');
            });
            
            displayProducts();
        }

        function searchProducts() {
            searchTerm = document.getElementById('searchInput').value;
            displayProducts();
        }

        function viewProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const modal = document.getElementById('productDetailModal');
            const images = product.images?.map(img => `
                <img src="${img}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 20px; margin-bottom: 10px;">
            `).join('') || '<div style="height: 300px; background: var(--nardoo);"></div>';

            document.getElementById('productDetailContent').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">${product.name}</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>${images}</div>
                    <div>
                        <div style="margin-bottom: 20px;">
                            <span style="background: var(--gold); padding: 5px 15px; border-radius: 20px;">${getCategoryName(product.category)}</span>
                        </div>
                        <div style="font-size: 32px; color: var(--gold); margin-bottom: 20px;">${product.price.toLocaleString()} دج</div>
                        <div style="margin-bottom: 20px;">التقييم: ${product.rating} ⭐</div>
                        <div class="product-stock ${product.stock <= 0 ? 'out-of-stock' : product.stock < 5 ? 'low-stock' : 'in-stock'}">
                            ${product.stock <= 0 ? 'غير متوفر' : `الكمية المتوفرة: ${product.stock}`}
                        </div>
                        <button class="btn-gold" style="width: 100%; margin-top: 20px;" onclick="addToCart(${product.id}); closeModal('productDetailModal')">
                            <i class="fas fa-shopping-cart"></i> أضف للسلة
                        </button>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // ========== إدارة السلة ==========
        function loadCart() {
            const saved = localStorage.getItem('cart');
            cart = saved ? JSON.parse(saved) : [];
            updateCartCounter();
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function updateCartCounter() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCounter').textContent = count;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock <= 0) {
                showNotification('المنتج غير متوفر', 'error');
                return;
            }

            const existing = cart.find(item => item.productId === productId);
            if (existing) {
                if (existing.quantity < product.stock) {
                    existing.quantity++;
                } else {
                    showNotification('الكمية غير كافية', 'warning');
                    return;
                }
            } else {
                cart.push({
                    productId,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }

            saveCart();
            updateCartCounter();
            updateCartDisplay();
            showNotification('تمت الإضافة إلى السلة', 'success');
        }

        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('open');
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const itemsDiv = document.getElementById('cartItems');
            const totalSpan = document.getElementById('cartTotal');

            if (cart.length === 0) {
                itemsDiv.innerHTML = '<div style="text-align: center; padding: 40px;">السلة فارغة</div>';
                totalSpan.textContent = '0 دج';
                return;
            }

            let total = 0;
            itemsDiv.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                return `
                    <div class="cart-item">
                        <div class="cart-item-image">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-price">${item.price.toLocaleString()} دج</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="updateCartItem(${item.productId}, ${item.quantity - 1})">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateCartItem(${item.productId}, ${item.quantity + 1})">+</button>
                                <button class="quantity-btn" onclick="removeFromCart(${item.productId})" style="background: #f87171;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            totalSpan.textContent = `${total.toLocaleString()} دج`;
        }

        function updateCartItem(productId, newQuantity) {
            const item = cart.find(i => i.productId === productId);
            const product = products.find(p => p.id === productId);

            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }

            if (newQuantity > product.stock) {
                showNotification('الكمية غير متوفرة', 'warning');
                return;
            }

            item.quantity = newQuantity;
            saveCart();
            updateCartCounter();
            updateCartDisplay();
        }

        function removeFromCart(productId) {
            cart = cart.filter(i => i.productId !== productId);
            saveCart();
            updateCartCounter();
            updateCartDisplay();
            showNotification('تمت إزالة المنتج', 'info');
        }

        function checkoutCart() {
            if (cart.length === 0) {
                showNotification('السلة فارغة', 'warning');
                return;
            }

            let message = "🛍️ *طلب جديد*\n\n";
            cart.forEach(item => {
                message += `📦 ${item.name} x${item.quantity} = ${(item.price * item.quantity).toLocaleString()} دج\n`;
            });
            message += `\n💰 الإجمالي: ${cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toLocaleString()} دج`;

            window.open(`https://wa.me/213562243648?text=${encodeURIComponent(message)}`, '_blank');
            
            cart = [];
            saveCart();
            updateCartCounter();
            toggleCart();
            showNotification('تم إرسال الطلب', 'success');
        }

        // ========== إدارة المستخدمين ==========
        function loadUsers() {
            const saved = localStorage.getItem('users');
            if (saved) {
                users = JSON.parse(saved);
            } else {
                users = [
                    { id: 1, name: 'مدير', email: 'azer@nakha.com', password: '12345', role: 'admin' }
                ];
            }
        }

        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const buttons = document.querySelectorAll('#loginModal .btn-gold, #loginModal .btn-outline-gold');

            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                buttons[0].className = 'btn-gold';
                buttons[1].className = 'btn-outline-gold';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                buttons[0].className = 'btn-outline-gold';
                buttons[1].className = 'btn-gold';
            }
        }

        function toggleMerchantFields() {
            const isMerchant = document.getElementById('isMerchant').checked;
            document.getElementById('merchantFields').style.display = isMerchant ? 'block' : 'none';
        }

        function handleLogin() {
            const username = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // البحث عن المستخدم - تعديل هنا لحل مشكلة تسجيل الدخول
            const user = users.find(u => (u.email === username || u.name === username) && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                closeModal('loginModal');
                showNotification(`مرحباً ${user.name}`, 'success');

                if (user.role === 'admin') {
                    document.getElementById('dashboardBtn').style.display = 'flex';
                    document.getElementById('userBtn').innerHTML = '<i class="fas fa-crown"></i>';
                } else {
                    document.getElementById('userBtn').innerHTML = '<i class="fas fa-user"></i>';
                }
            } else {
                showNotification('بيانات الدخول غير صحيحة', 'error');
            }
        }

        function handleRegister() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const isMerchant = document.getElementById('isMerchant').checked;

            if (!name || !email || !password) {
                showNotification('الرجاء ملء جميع الحقول', 'error');
                return;
            }

            if (users.find(u => u.email === email)) {
                showNotification('البريد الإلكتروني مستخدم بالفعل', 'error');
                return;
            }

            const newUser = {
                id: users.length + 1,
                name,
                email,
                password,
                role: isMerchant ? 'merchant_pending' : 'customer'
            };

            users.push(newUser);
            saveUsers();
            showNotification('تم التسجيل بنجاح', 'success');
            switchAuthTab('login');
        }

        // ========== لوحة التحكم ==========
        function openDashboard() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('غير مصرح لك بالدخول', 'error');
                return;
            }

            document.getElementById('dashboardModal').style.display = 'flex';
            showDashboardTab('overview');
        }

        function showDashboardTab(tab) {
            const buttons = document.querySelectorAll('#dashboardModal .btn-gold, #dashboardModal .btn-outline-gold');
            buttons.forEach(btn => {
                if (btn.textContent.includes('نظرة عامة')) btn.className = 'btn-outline-gold';
                if (btn.textContent.includes('إدارة المنتجات')) btn.className = 'btn-outline-gold';
                if (btn.textContent.includes('الطلبات')) btn.className = 'btn-outline-gold';
                if (btn.textContent.includes('التجار')) btn.className = 'btn-outline-gold';
                if (btn.textContent.includes('الإحصائيات')) btn.className = 'btn-outline-gold';
            });
            
            event.target.className = 'btn-gold';

            const content = document.getElementById('dashboardContent');

            switch(tab) {
                case 'overview':
                    content.innerHTML = `
                        <h3>نظرة عامة</h3>
                        <p>إجمالي المنتجات: ${products.length}</p>
                        <p>إجمالي المستخدمين: ${users.length}</p>
                        <p>إجمالي الطلبات: ${cart.length}</p>
                    `;
                    break;
                case 'products':
                    content.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <h3>إدارة المنتجات</h3>
                            <button class="btn-gold" onclick="showAddProductModal()">+ إضافة منتج</button>
                        </div>
                        <div style="display: grid; gap: 10px;">
                            ${products.map(p => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--glass); border-radius: 10px;">
                                    <span>${p.name} - ${p.price} دج</span>
                                    <div>
                                        <button class="btn-outline-gold" onclick="editProduct(${p.id})" style="padding: 5px 10px;">تعديل</button>
                                        <button class="btn-outline-gold" onclick="deleteProduct(${p.id})" style="padding: 5px 10px; background: #f87171;">حذف</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                case 'merchants':
                    const pending = users.filter(u => u.role === 'merchant_pending');
                    content.innerHTML = `
                        <h3>طلبات التجار</h3>
                        ${pending.map(m => `
                            <div style="background: var(--glass); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                                <p>${m.name} - ${m.email}</p>
                                <button class="btn-gold" onclick="approveMerchant(${m.id})">موافقة</button>
                            </div>
                        `).join('')}
                    `;
                    break;
                default:
                    content.innerHTML = '<h3>قيد التطوير</h3>';
            }
        }

        function approveMerchant(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.role = 'merchant_approved';
                saveUsers();
                showNotification('تمت الموافقة على التاجر', 'success');
                showDashboardTab('merchants');
            }
        }

        // ========== إدارة المنتجات (للمدير) ==========
        function showAddProductModal() {
            document.getElementById('modalTitle').textContent = 'إضافة منتج جديد';
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productStock').value = '';
            document.getElementById('editingProductId').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            
            const merchantSelect = document.getElementById('productMerchant');
            merchantSelect.innerHTML = '<option value="">منتج عام</option>';
            users.filter(u => u.role === 'merchant_approved').forEach(m => {
                merchantSelect.innerHTML += `<option value="${m.id}">${m.name}</option>`;
            });

            document.getElementById('productModal').style.display = 'flex';
        }

        function handleImageUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('imagePreview');
            const imagesData = [];

            for (let i = 0; i < files.length; i++) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML += `<img src="${e.target.result}" class="preview-image">`;
                    imagesData.push(e.target.result);
                    document.getElementById('productImagesData').value = JSON.stringify(imagesData);
                };
                reader.readAsDataURL(files[i]);
            }
        }

        function saveProduct() {
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const editingId = document.getElementById('editingProductId').value;
            const imagesData = document.getElementById('productImagesData').value;

            if (!name || !category || !price || !stock) {
                showNotification('الرجاء ملء جميع الحقول', 'error');
                return;
            }

            const images = imagesData ? JSON.parse(imagesData) : ["https://via.placeholder.com/300/2c5e4f/ffffff?text=منتج"];

            if (editingId) {
                const index = products.findIndex(p => p.id == editingId);
                if (index !== -1) {
                    products[index] = { ...products[index], name, category, price, stock, images };
                }
                showNotification('تم تعديل المنتج', 'success');
            } else {
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                products.push({
                    id: newId,
                    name,
                    category,
                    price,
                    stock,
                    rating: 0,
                    images,
                    merchantId: null
                });
                showNotification('تم إضافة المنتج', 'success');
            }

            saveProducts();
            displayProducts();
            closeModal('productModal');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            document.getElementById('modalTitle').textContent = 'تعديل المنتج';
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('editingProductId').value = id;

            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            if (product.images) {
                product.images.forEach(img => {
                    preview.innerHTML += `<img src="${img}" class="preview-image">`;
                });
            }

            document.getElementById('productModal').style.display = 'flex';
        }

        function deleteProduct(id) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                products = products.filter(p => p.id !== id);
                saveProducts();
                displayProducts();
                showNotification('تم حذف المنتج', 'info');
            }
        }

        // ========== التهيئة ==========
        window.onload = function() {
            loadUsers();
            loadProducts();
            loadCart();

            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.role === 'admin') {
                    document.getElementById('dashboardBtn').style.display = 'flex';
                    document.getElementById('userBtn').innerHTML = '<i class="fas fa-crown"></i>';
                }
            }

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                isDarkMode = savedTheme === 'dark';
                document.body.classList.toggle('light-mode', !isDarkMode);
                document.getElementById('themeToggle').innerHTML = isDarkMode ? 
                    '<i class="fas fa-moon"></i><span>ليلي</span>' : 
                    '<i class="fas fa-sun"></i><span>نهاري</span>';
            }

            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                }, 500);
            }, 1000);
        };

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
